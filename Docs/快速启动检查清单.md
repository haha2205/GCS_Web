# 快速启动检查清单

## 系统环境检查

### 前置条件
- [ ] Node.js 16+ 已安装
- [ ] Python 3.8+ 已安装
- [ ] npm 命令可用
- [ ] pip 命令可用
- [ ] Git 已安装（可选，用于克隆代码）

### 验证安装
```bash
# 检查 Node.js 版本
node --version  # 应显示 v16.x.x 或更高版本

# 检查 Python 版本
python --version  # 应显示 3.8.x 或更高版本

# 检查 npm 版本
npm --version

# 检查 pip 版本
pip --version
```

## 依赖安装检查

### 根目录依赖
```bash
cd Apollo-GCS-Web
npm install
```
- [ ] 根目录 `package.json` 依赖安装成功
- [ ] 无报错信息
- [ ] `node_modules` 文件夹已创建

### 前端依赖
```bash
cd src-frontend
npm install
```
- [ ] 前端依赖安装成功
- [ ] 无报错信息
- [ ] `node_modules` 文件夹已创建

### 后端依赖
```bash
cd src-python
pip install -r requirements.txt
```
- [ ] Python依赖安装成功
- [ ] 无报错信息

### 一键安装（推荐）
```bash
cd Apollo-GCS-Web
npm install
```
- [ ] 全部依赖自动安装成功
- [ ] 前端、后端依赖均完整

## 端口可用性检查

### 检查端口占用情况
```bash
# Windows PowerShell
Get-NetTCPConnection -LocalPort 8000,5173,30509,18504,18507,18511 -ErrorAction SilentlyContinue | Format-Table

# Windows CMD
netstat -ano | findstr ":8000 :5173 :30509 :18504 :18507 :18511"

# Linux/macOS
lsof -i :8000 -i :5173 -i :30509 -i :18504 -i :18507 -i :18511
```

### 必需端口
- [ ] **8000** - 后端API服务器（FastAPI）
- [ ] **5173** - 前端开发服务器（Vite）
- [ ] **30509** - UDP监听端口（遥测数据）
- [ ] **18504** - UDP发送端口（控制指令）
- [ ] **18507** - UDP监听端口（LiDAR数据）
- [ ] **18511** - UDP监听端口（规划数据）

## 服务启动检查

### 1. 启动后端服务

```bash
npm run dev:backend
```

**预期输出：**
```
INFO: Started server process [1234]
INFO: Waiting for application startup.
INFO: Application startup complete.
INFO: Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO: 地面站配置信息
INFO: ============================================================
INFO: 运行模式: testing
INFO: 接收配置: 0.0.0.0:30509
INFO: 发送目标: 127.0.0.1:18504
INFO: ============================================================
```

**检查项：**
- [ ] 终端显示启动成功信息
- [ ] 无错误或异常信息
- [ ] 服务器进程正常运行

**验证服务：**
```bash
# 访问根路径
curl http://localhost:8000/
# 预期: {"name":"Apollo GCS Web Backend","status":"running","version":"1.0.0"}

# 访问健康检查
curl http://localhost:8000/health
# 预期: {"status":"healthy","websocket_connections":0,"timestamp":1705900000000}

# 访问API文档
# 浏览器打开: http://localhost:8000/docs
```

- [ ] 根路径返回正确的JSON响应
- [ ] 健康检查返回状态为healthy
- [ ] API文档页面可访问

### 2. 启动前端服务

```bash
npm run dev:frontend
```

**预期输出：**
```
VITE v5.x.x  ready in xxx ms

➜  Local:   http://localhost:5173/
➜  Network: use --host to expose
➜  press h + enter to show help
```

**检查项：**
- [ ] Vite服务器启动成功
- [ ] 显示本地访问地址
- [ ] 无编译错误或警告

**验证服务：**
```bash
# 浏览器访问
http://localhost:5173/
```

- [ ] 浏览器显示Apollo GCS界面
- [ ] 页面无报错（按F12查看控制台）
- [ ] 左侧导航栏正常显示
- [ ] 配置面板可访问

### 3. 测试WebSocket连接

**前端控制台测试：**
```javascript
// 按F12打开浏览器控制台，在Console标签页执行
const ws = new WebSocket('ws://localhost:8000/ws/drone');
ws.onopen = () => console.log('✓ WebSocket已连接');
ws.onclose = () => console.log('✗ WebSocket已断开');
ws.onerror = (e) => console.error('WebSocket错误:', e);
```

**检查项：**
- [ ] WebSocket连接成功（显示"✓ WebSocket已连接"）
- [ ] 连接状态保持稳定
- [ ] 无连接错误或断开

### 4. 测试UDP连接

**后端端点测试：**
```bash
# 启动UDP服务器
curl -X POST http://localhost:8000/api/udp/start

# 预期响应:
# {"status":"success","message":"UDP服务器已启动"}

# 查询UDP状态
curl http://localhost:8000/api/udp/status

# 预期响应:
# {"status":"success","data":{"connected":true,...}}

# 停止UDP服务器
curl -X POST http://localhost:8000/api/udp/stop

# 预期响应:
# {"status":"success","message":"UDP服务器已停止"}
```

**检查项：**
- [ ] UDP启动API返回成功
- [ ] UDP状态API返回connected=true
- [ ] UDP停止API返回成功
- [ ] 后端日志显示UDP服务器启动/停止信息

**前端界面测试：**
1. 打开浏览器访问 http://localhost:5173/
2. 点击左侧"配置"面板
3. 点击"连接 UDP"按钮
4. 观察按钮状态变化和日志输出

- [ ] 按钮文字从"连接 UDP"变为"断开 UDP"
- [ ] 按钮颜色从绿色变为红色
- [ ] 日志显示连接成功信息
- [ ] 再次点击按钮可以正常断开

### 5. 测试数据接收（需要模拟飞控）

**使用Python模拟器发送UDP数据：**
```python
# 创建测试脚本 test_udp_sender.py
import socket
import struct
import time

# 创建UDP socket
sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

# 构造测试数据包（MiniQGCLink协议格式）
# 包头: 0xAA 0xBB 0xCC 0xDD
# 功能码: 0x41 (fcs_states)
# 数据长度: 2字节
# 数据内容: 实际数据
header = bytes([0xAA, 0xBB, 0xCC, 0xDD])
func_code = struct.pack('<H', 0x41)  # 小端序
data_length = struct.pack('<H', 4)  # 假设4字节数据
data = b'\x00\x00\x00\x00'  # 测试数据

packet = header + func_code + data_length + data

# 发送到后端
sock.sendto(packet, ('127.0.0.1', 30509))
print("测试数据包已发送")
sock.close()
```

- [ ] 模拟脚本成功发送UDP数据包
- [ ] 后端日志显示接收到数据
- [ ] 前端WebSocket接收到数据推送
- [ ] 界面正确更新显示

## 一键启动测试

### 完整启动流程
```bash
# 1. 安装所有依赖（首次运行）
npm install

# 2. 一键启动所有服务
npm run dev
```

**预期流程：**
1. Electron应用窗口启动
2. 前端开发服务器启动（端口5173）
3. 后端API服务器启动（端口8000）
4. 界面正常加载显示

**检查项：**
- [ ] 所有三个服务同时启动
- [ ] Electron窗口正常显示
- [ ] 前端界面正确渲染
- [ ] 无崩溃或报错

## 常见问题排查

### 问题1：后端启动失败

**错误信息：**
```
ModuleNotFoundError: No module named 'fastapi'
```

**解决方案：**
```bash
cd src-python
pip install -r requirements.txt
```

### 问题2：端口被占用

**错误信息：**
```
[Errno 10048] address already in use
```

**解决方案：**
```bash
# Windows
netstat -ano | findstr :8000
taskkill /PID <进程ID> /F

# Linux/macOS
lsof -i :8000
kill <进程ID>
```

### 问题3：前端界面空白

**可能原因：**
- webpack/vite编译失败
- 静态资源加载失败

**解决方案：**
```bash
cd src-frontend
rm -rf node_modules
npm install
npm run dev
```

### 问题4：WebSocket连接失败

**错误信息：**
```
WebSocket connection to 'ws://localhost:8000/ws/drone' failed
```

**解决方案：**
1. 确认后端服务正常运行
2. 检查防火墙设置
3. 确认端口8000未被阻止
4. 启用浏览器控制台查看详细错误

## 性能基准测试

### 1. 前端页面加载时间
- [ ] 首次加载 < 3秒
- [ ] 后续刷新 < 1秒

### 2. API响应时间
```bash
# 测试API响应时间
time curl http://localhost:8000/health
```
- [ ] 健康检查响应 < 100ms
- [ ] 配置API响应 < 200ms

### 3. WebSocket消息延迟
- [ ] 消息发送到接收延迟 < 50ms
- [ ] 大量消息处理无阻塞

### 4. UDP数据处理
- [ ] 数据包接收稳定
- [ ] 无丢包或乱序
- [ ] CPU使用率 < 50%

## 完成总结

### 所有检查项完成后
- [ ] ✅ 系统环境满足要求
- [ ] ✅ 所有依赖安装成功
- [ ] ✅ 端口可用且未被占用
- [ ] ✅ 后端服务正常运行
- [ ] ✅ 前端服务正常运行
- [ ] ✅ WebSocket连接正常
- [ ] ✅ UDP连接正常
- [ ] ✅ 数据接收正常
- [ ] ✅ 界面显示正常
- [ ] ✅ 性能达到预期

### 下一步
如果所有检查项都已通过，恭喜！您的Apollo GCS系统已成功启动并运行。您可以：

1. 开始使用配置面板管理连接
2. 查看实时遥测数据
3. 发送控制指令到飞控
4. 记录飞行日志
5. 生成DSM分析报告

### 需要帮助？
如果遇到任何问题，请参考：
- [README.md](../README.md) - 详细的使用说明
- [配置说明.md](配置说明.md) - 配置参数说明
- [IP配置说明.md](IP配置说明.md) - 网络配置指南
- [UDP重连功能测试指南.md](UDP重连功能测试指南.md) - 重连功能测试

或联系技术支持获取帮助。